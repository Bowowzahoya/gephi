import pandas as pd
import unittest

from context import gephi
from gephi import clusters as cl

FOLD = "res/gephi_files/"

class TestClusters(unittest.TestCase):
    @classmethod
    def setUpClass(cls):
        cls.TEST_NODES = pd.read_csv(FOLD+"Nodes_clustered.csv", index_col=0)
        cls.TEST_EDGES = pd.read_excel(FOLD+"edges.xlsx", index_col=0)
        
    @unittest.skip
    def test_get_cluster(self):
        print(self.TEST_NODES)
        clusters = cl.get_cluster_info(self.TEST_NODES, self.TEST_EDGES)
        print(clusters)
        clusters.to_excel("out/clusters.xlsx")
        
    @unittest.skip
    def test_get_overlap_from_weights(self):
        overlap = cl._get_overlap_from_weights(self.TEST_EDGES, self.TEST_NODES["size"])
        assert overlap.iloc[2] == 26
        
    def test_get_weighted_mean_weight(self):
        one_node_edges = self.TEST_EDGES.loc[self.TEST_EDGES["Source"] == "4-Nitrophenol"]
        weighted_mean_weight = cl._get_weighted_mean_weight(one_node_edges, self.TEST_NODES["size"])
        print(weighted_mean_weight)


if __name__ == '__main__':
    unittest.main()